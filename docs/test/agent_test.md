# Agent 测试方案

## 测试目标

验证 Agent 系统的核心功能：

1. 节点注册
2. 心跳机制
3. 状态监控
4. 资源管理

## 测试环境

- 开发环境：本地开发机
- 测试工具：自定义测试 Agent
- 数据存储：本地 YAML 文件

## 测试用例

### 1. 节点注册测试

- 前置条件：Agent 服务器已启动
- 测试步骤：
  1. 启动测试 Agent
  2. 发送注册请求
  3. 验证注册响应
- 预期结果：
  - 注册成功
  - 返回有效的 session_id
  - 节点信息被正确记录

### 2. 心跳机制测试

- 前置条件：节点已成功注册
- 测试步骤：
  1. 定期发送心跳请求
  2. 验证心跳响应
  3. 检查节点在线状态
- 预期结果：
  - 心跳请求成功
  - 节点状态保持在线
  - 最后在线时间正确更新

### 3. 状态监控测试

- 前置条件：节点已成功注册并保持心跳
- 测试步骤：
  1. 发送节点状态更新
  2. 验证状态更新
  3. 检查状态持久化
- 预期结果：
  - 状态更新成功
  - 状态信息被正确记录
  - 状态变更可被查询

### 4. 资源管理测试

- 前置条件：节点已成功注册
- 测试步骤：
  1. 更新节点资源信息
  2. 验证资源信息
  3. 检查资源使用情况
- 预期结果：
  - 资源信息更新成功
  - 资源使用情况正确记录
  - 资源信息可被查询

## 测试执行计划

1. 环境准备

   - 启动 Agent 服务器
   - 准备测试数据
   - 配置测试环境

2. 功能测试

   - 执行节点注册测试
   - 执行心跳机制测试
   - 执行状态监控测试
   - 执行资源管理测试

3. 结果验证
   - 检查测试日志
   - 验证数据一致性
   - 生成测试报告

## 测试工具

- 测试 Agent：`cmd/agent/test/agent/main.go`
- 数据文件：`data/gamenodes.yaml`
- 日志文件：`logs/agent_test.log`

## 注意事项

1. 测试前确保数据目录存在
2. 测试过程中保持日志记录
3. 测试完成后清理测试数据
4. 记录所有异常情况
